<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ üíï</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #ff6b9d, #c44569, #f7931e);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
        }
        .flags {
            position: fixed; top: 12px; right: 12px; display: flex; gap: 10px; z-index: 1000;
        }
        .flag-btn {
            width: 46px; height: 34px; border: 2px solid rgba(255,255,255,0.5);
            border-radius: 6px; overflow: hidden; cursor: pointer; transition: all 0.2s;
        }
        .flag-btn:hover { transform: scale(1.1); border-color: white; }
        .flag-btn img { width: 100%; height: 100%; object-fit: cover; }
        .flag-btn.active { border-color: white; box-shadow: 0 0 0 3px rgba(255,255,255,0.7); }

        #generator, #valentines {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; padding: 20px 15px; text-align: center;
        }
        h1 {
            font-size: clamp(2.3rem, 7.5vw, 4.2rem); margin-bottom: 30px;
            line-height: 1.2; text-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .name { color: #fff200; text-shadow: 0 0 20px #ff00aa; }
        input {
            padding: 16px 24px; font-size: 1.4rem; width: 100%; max-width: 420px;
            border-radius: 999px; border: none; margin: 20px 0; text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .btn {
            padding: 16px 48px; font-size: 1.4rem; font-weight: bold;
            border: none; border-radius: 999px; cursor: pointer; margin: 12px 8px;
            min-width: 160px; box-shadow: 0 6px 20px rgba(0,0,0,0.35); transition: all 0.25s;
        }
        .btn:active { transform: scale(0.96); }
        #createBtn { background: #00ff9d; color: #000; }
        #createBtn:hover { transform: scale(1.06); }
        .yes { background: #00ff9d; color: #000; }
        .no  { background: #ff4444; color: white; position: relative; }
        .no.moved {
            position: fixed !important;
            transform: scale(0.7);
            z-index: 100;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            pointer-events: auto;
        }
        #qrContainer {
            margin: 40px 0 20px; background: white; padding: 20px;
            border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        .hearts { position: fixed; inset: 0; pointer-events: none; z-index: 5; overflow: hidden; }
        .heart {
            position: absolute; font-size: 2rem; animation: fall linear forwards; opacity: 0.85;
        }
        @keyframes fall {
            0% { transform: translateY(-15vh) translateX(var(--x)) rotate(0deg); opacity: 1; }
            100% { transform: translateY(115vh) translateX(calc(var(--x) + var(--drift))) rotate(1080deg); opacity: 0; }
        }
        .hidden { display: none !important; }

        @media (max-width: 500px) {
            .btn { padding: 14px 36px; font-size: 1.2rem; min-width: 140px; }
            h1 { font-size: 2.4rem; }
        }
    </style>
</head>
<body>

<div class="flags">
    <button class="flag-btn active" data-lang="uk" onclick="setLang('uk')"><img src="https://flagcdn.com/w40/ua.png" alt="UA"></button>
    <button class="flag-btn" data-lang="en" onclick="setLang('en')"><img src="https://flagcdn.com/w40/gb.png" alt="GB"></button>
</div>

<div class="hearts" id="hearts"></div>

<div id="generator">
    <h1>–°—Ç–≤–æ—Ä–∏ —Å–≤–æ—é –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É üíï</h1>
    <input type="text" id="nameInput" placeholder="–í–≤–µ–¥–∏ —ñ–º'—è..." autocomplete="off">
    <button id="createBtn" class="btn">–°—Ç–≤–æ—Ä–∏—Ç–∏ ‚Üí</button>
</div>

<div id="valentines" class="hidden">
    <h1 id="mainTitle">–¢–∏ –±—É–¥–µ—à –º–æ—î—é –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ—é, <span class="name" id="valName">...</span>? üíï</h1>

    <div>
        <button id="yesBtn" class="btn yes">–¢–∞–∫ üòç</button>
        <button id="noBtn" class="btn no">–ù—ñ ‚ùå</button>
    </div>

    <div id="qrContainer" class="hidden">
        <div id="qrcode"></div>
        <p id="qrText" style="color:#333; margin-top:12px;">–°–∫–∞–Ω—É–π, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏</p>
    </div>

    <div id="shareButtons" class="hidden">
        <button class="btn" onclick="downloadQR()">–°–∫–∞—á–∞—Ç–∏ QR</button>
        <button class="btn" onclick="copyLink()">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</button>
    </div>
</div>

<script>
const texts = {
    uk: {
        title: "–¢–∏ –±—É–¥–µ—à –º–æ—î—é –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ—é, ",
        titleEnd: "? üíï",
        yes: "–¢–∞–∫ üòç",
        no: "–ù—ñ ‚ùå",
        create: "–°—Ç–≤–æ—Ä–∏—Ç–∏ ‚Üí",
        placeholder: "–í–≤–µ–¥–∏ —ñ–º'—è...",
        qrText: "–°–∫–∞–Ω—É–π, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏",
        alertYes: "–Ø –∑–Ω–∞–≤(–ª–∞), —â–æ —Å–∫–∞–∂–µ—à –¢–ê–ö! üòçüíñ",
        alertNo: "–ù—É —è–∫ —Ç–æ –Ω—ñ? üò≠"
    },
    en: {
        title: "Will you be my valentine, ",
        titleEnd: "? üíï",
        yes: "Yes üòç",
        no: "No ‚ùå",
        create: "Create ‚Üí",
        placeholder: "Enter name...",
        qrText: "Scan to open",
        alertYes: "I knew you'd say YES! üòçüíñ",
        alertNo: "How can it be no? üò≠"
    }
};

let lang = 'uk';
const urlParams = new URLSearchParams(window.location.search);
let name = urlParams.get('name');
name = name ? decodeURIComponent(name).trim() : '';
const share = urlParams.get('share') !== 'false';

const generator = document.getElementById('generator');
const valentines = document.getElementById('valentines');
const mainTitle = document.getElementById('mainTitle');
const valNameSpan = document.getElementById('valName');
const nameInput = document.getElementById('nameInput');
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const createBtn = document.getElementById('createBtn');
const qrContainer = document.getElementById('qrContainer');
const qrDiv = document.getElementById('qrcode');
const qrTextP = document.getElementById('qrText');
const shareButtons = document.getElementById('shareButtons');

function setLang(newLang) {
    lang = newLang;
    document.querySelectorAll('.flag-btn').forEach(b => b.classList.remove('active'));
    document.querySelector(`.flag-btn[data-lang="${lang}"]`).classList.add('active');

    if (name) {
        mainTitle.innerHTML = `${texts[lang].title}<span class="name">${name}</span>${texts[lang].titleEnd}`;
        yesBtn.textContent = texts[lang].yes;
        noBtn.textContent = texts[lang].no;
    } else {
        createBtn.textContent = texts[lang].create;
        nameInput.placeholder = texts[lang].placeholder;
    }
    qrTextP.textContent = texts[lang].qrText;
}

function createHeart() {
    const h = document.createElement('div');
    h.className = 'heart';
    h.innerHTML = Math.random() > 0.5 ? 'üíï' : '‚ù§Ô∏è';
    h.style.left = Math.random() * 100 + 'vw';
    h.style.setProperty('--x', (Math.random() * 50 - 25) + 'vw');
    h.style.setProperty('--drift', (Math.random() * 80 - 40) + 'vw');
    h.style.animationDuration = (7 + Math.random() * 9) + 's';
    h.style.animationDelay = Math.random() * 5 + 's';
    document.getElementById('hearts').appendChild(h);
    setTimeout(() => h.remove(), 18000);
}

setInterval(createHeart, 800);

function generateValentine() {
    const val = nameInput.value.trim();
    if (!val) {
        alert(lang === 'uk' ? "–í–≤–µ–¥–∏ —ñ–º'—è –±—É–¥—å –ª–∞—Å–∫–∞ üíï" : "Please enter a name üíï");
        return;
    }
    const url = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(val)}&share=true`;
    window.location.href = url;
}

createBtn.onclick = generateValentine;

yesBtn.onclick = () => alert(texts[lang].alertYes);

// --- –ö–Ω–æ–ø–∫–∞ "–ù—ñ" —Ç—ñ–∫–∞—î ---
noBtn.onclick = function noFn() {
    const rect = noBtn.getBoundingClientRect();
    const maxX = window.innerWidth - rect.width * 1.2;
    const maxY = window.innerHeight - rect.height * 1.2 - 100;

    const newX = Math.random() * maxX;
    const newY = 80 + Math.random() * maxY;

    noBtn.classList.add('moved');
    noBtn.style.left = newX + 'px';
    noBtn.style.top = newY + 'px';

    setTimeout(() => {
        noBtn.onclick = null;
        noBtn.textContent = lang === 'uk' ? '–¢–ê –ë–ï–†–ò –¢–ê–ö üò°' : 'JUST SAY YES üò°';
        noBtn.style.background = '#00ff9d';
        noBtn.style.color = '#000';
    }, 700);
};

function downloadQR() {
    const canvas = qrDiv.querySelector('canvas');
    if (!canvas) return;
    const a = document.createElement('a');
    a.download = `valentine-${name || 'secret'}.png`;
    a.href = canvas.toDataURL('image/png');
    a.click();
}

function copyLink() {
    const link = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(name)}&share=true`;
    navigator.clipboard.writeText(link).then(() => {
        alert(lang === 'uk' ? "–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ! üíï" : "Link copied! üíï");
    }).catch(() => alert(link));
}

// INIT
if (name) {
    valNameSpan.textContent = name;
    mainTitle.innerHTML = `${texts[lang].title}<span class="name">${name}</span>${texts[lang].titleEnd}`;
    generator.classList.add('hidden');
    valentines.classList.remove('hidden');

    if (share) {
        qrContainer.classList.remove('hidden');
        shareButtons.classList.remove('hidden');

        const link = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(name)}&share=true`;
        new QRCode(qrDiv, {
            text: link,
            width: 240,
            height: 240,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });
    }
} else {
    generator.classList.remove('hidden');
}

setLang('uk');
</script>
</body>
</html>

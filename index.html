<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ üíï</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #ff6b9d, #c44569, #f7931e);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            user-select: none;
        }
        .flags {
            position: fixed;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        .flag-btn {
            width: 44px;
            height: 33px;
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
        }
        .flag-btn:hover { transform: scale(1.08); border-color: white; }
        .flag-btn img { width: 100%; height: 100%; object-fit: cover; }
        .flag-btn.active { border-color: white; box-shadow: 0 0 0 3px rgba(255,255,255,0.6); }

        #generator, #valentines {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
        }
        h1 { font-size: clamp(2.4rem, 8vw, 4.5rem); margin-bottom: 30px; text-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .name { color: #fff200; text-shadow: 0 0 15px #ff00aa; }
        input {
            padding: 16px 24px;
            font-size: 1.4rem;
            width: 90%;
            max-width: 420px;
            border-radius: 50px;
            border: none;
            margin: 20px 0;
            text-align: center;
        }
        button {
            padding: 14px 38px;
            font-size: 1.3rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            transition: all 0.25s;
        }
        #createBtn { background: #00ff9d; color: black; font-weight: bold; }
        #createBtn:hover { transform: scale(1.07); }
        .yes { background: #00ff9d; color: black; font-weight: bold; }
        .no  { background: #ff4444; color: white; }
        #qrContainer { margin: 35px 0; background: white; padding: 18px; border-radius: 16px; }
        .hearts { position: fixed; inset: 0; pointer-events: none; z-index: 5; overflow: hidden; }
        .heart {
            position: absolute;
            font-size: 1.8rem;
            animation: fall linear forwards;
            opacity: 0.9;
        }
        @keyframes fall {
            0% { transform: translateY(-10vh) translateX(var(--x)) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) translateX(calc(var(--x) + var(--drift))) rotate(720deg); opacity: 0; }
        }
        .hidden { display: none !important; }
        @media (max-width: 500px) {
            h1 { font-size: 2.6rem; }
            button { padding: 12px 30px; font-size: 1.1rem; }
        }
    </style>
</head>
<body>

<div class="flags">
    <button class="flag-btn active" data-lang="uk" onclick="setLang('uk')"><img src="https://flagcdn.com/w40/ua.png" alt="UA"></button>
    <button class="flag-btn" data-lang="en" onclick="setLang('en')"><img src="https://flagcdn.com/w40/gb.png" alt="GB"></button>
</div>

<div class="hearts" id="hearts"></div>

<div id="generator">
    <h1>–°—Ç–≤–æ—Ä–∏ —Å–≤–æ—é –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É üíï</h1>
    <input type="text" id="nameInput" placeholder="–í–≤–µ–¥–∏ —ñ–º'—è..." autocomplete="off">
    <button id="createBtn">–°—Ç–≤–æ—Ä–∏—Ç–∏ –º–æ—é –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É ‚Üí</button>
</div>

<div id="valentines" class="hidden">
    <h1 id="mainTitle">–¢–∏ –±—É–¥–µ—à –º–æ—î—é –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ—é, <span class="name" id="valName">...</span>? üíï</h1>
    
    <div>
        <button class="yes" id="yesBtn">–¢–∞–∫ üòç</button>
        <button class="no" id="noBtn">–ù—ñ ‚ùå</button>
    </div>

    <div id="qrContainer">
        <div id="qrcode"></div>
        <p style="color:#333; margin-top:12px;">–°–∫–∞–Ω—É–π, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏</p>
    </div>

    <button onclick="downloadQR()">–°–∫–∞—á–∞—Ç–∏ QR</button>
    <button onclick="copyLink()">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</button>
</div>

<script>
const texts = {
    uk: {
        title: "–¢–∏ –±—É–¥–µ—à –º–æ—î—é –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ—é, ",
        titleEnd: "? üíï",
        yes: "–¢–∞–∫ üòç",
        no: "–ù—ñ ‚ùå",
        create: "–°—Ç–≤–æ—Ä–∏—Ç–∏ –º–æ—é –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É ‚Üí",
        placeholder: "–í–≤–µ–¥–∏ —ñ–º'—è...",
        qrText: "–°–∫–∞–Ω—É–π, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏"
    },
    en: {
        title: "Will you be my valentine, ",
        titleEnd: "? üíï",
        yes: "Yes üòç",
        no: "No ‚ùå",
        create: "Create my valentine ‚Üí",
        placeholder: "Enter name...",
        qrText: "Scan to open"
    }
};

let lang = 'uk';
let name = new URLSearchParams(window.location.search).get('name');
name = name ? decodeURIComponent(name).trim() : '';

const generator = document.getElementById('generator');
const valentines = document.getElementById('valentines');
const mainTitle = document.getElementById('mainTitle');
const valNameSpan = document.getElementById('valName');
const nameInput = document.getElementById('nameInput');
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const createBtn = document.getElementById('createBtn');
const qrDiv = document.getElementById('qrcode');
const qrTextP = document.querySelector('#qrContainer p');

function setLang(newLang) {
    lang = newLang;
    document.querySelectorAll('.flag-btn').forEach(b => b.classList.remove('active'));
    document.querySelector(`.flag-btn[data-lang="${lang}"]`).classList.add('active');

    if (name && name.length > 0) {
        // —É–∂–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∏
        mainTitle.innerHTML = `${texts[lang].title}<span class="name">${name}</span>${texts[lang].titleEnd}`;
        yesBtn.textContent = texts[lang].yes;
        noBtn.textContent = texts[lang].no;
    } else {
        // –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
        createBtn.textContent = texts[lang].create;
        nameInput.placeholder = texts[lang].placeholder;
    }

    qrTextP.textContent = texts[lang].qrText;
}

function createHeart() {
    const h = document.createElement('div');
    h.className = 'heart';
    h.innerHTML = Math.random() > 0.5 ? 'üíï' : '‚ù§Ô∏è';
    h.style.left = Math.random() * 100 + 'vw';
    h.style.setProperty('--x', (Math.random() * 40 - 20) + 'vw');
    h.style.setProperty('--drift', (Math.random() * 60 - 30) + 'vw');
    h.style.animationDuration = (6 + Math.random() * 8) + 's';
    h.style.animationDelay = Math.random() * 4 + 's';
    document.getElementById('hearts').appendChild(h);
    setTimeout(() => h.remove(), 16000);
}

setInterval(createHeart, 700);

function showValentine(nameVal) {
    name = nameVal;
    valNameSpan.textContent = name;
    mainTitle.innerHTML = `${texts[lang].title}<span class="name">${name}</span>${texts[lang].titleEnd}`;
    
    generator.classList.add('hidden');
    valentines.classList.remove('hidden');

    const link = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(name)}`;
    qrDiv.innerHTML = '';
    new QRCode(qrDiv, {
        text: link,
        width: 220,
        height: 220,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
    });
}

document.getElementById('createBtn').onclick = () => {
    const val = nameInput.value.trim();
    if (!val) {
        alert(lang === 'uk' ? "–í–≤–µ–¥–∏ —ñ–º'—è –±—É–¥—å –ª–∞—Å–∫–∞ üíï" : "Please enter a name üíï");
        return;
    }
    showValentine(val);
};

yesBtn.onclick = () => {
    alert(lang === 'uk' ? "–Ø –∑–Ω–∞–≤(–ª–∞), —â–æ —Å–∫–∞–∂–µ—à –¢–ê–ö! üòçüíñ" : "I knew you'd say YES! üòçüíñ");
};

noBtn.onclick = () => {
    alert(lang === 'uk' ? "–ù—É —è–∫ —Ç–æ –Ω—ñ? üò≠" : "How can it be no? üò≠");
};

function downloadQR() {
    const canvas = qrDiv.querySelector('canvas');
    if (!canvas) return;
    const a = document.createElement('a');
    a.download = `valentine-${name || 'secret'}.png`;
    a.href = canvas.toDataURL('image/png');
    a.click();
}

function copyLink() {
    const link = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(name)}`;
    navigator.clipboard.writeText(link).then(() => {
        alert(lang === 'uk' ? "–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ! üíï" : "Link copied! üíï");
    }).catch(() => {
        alert("–ù–µ –≤–∏–π—à–ª–æ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏\n" + link);
    });
}

// INIT
if (name && name.length > 0) {
    showValentine(name);
} else {
    generator.classList.remove('hidden');
}

setLang('uk');
</script>
</body>
</html>
